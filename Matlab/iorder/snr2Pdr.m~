%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%   Author: Xiaohui Liu (whulxh@gmail.com)
%   Date:   1/10/2014
%   Function: generate pdr vs snr theoretical curve for CC2420 radio
%% all in dB
function mean_pdr = snr2Pdr(mean_snr, sigma_s, sigma_n, packet_len_byte, packet_cnt)
    sigma_snr = sqrt(sigma_s ^ 2 + sigma_n ^ 2);
    len_in_bit = packet_len_byte * 8;
    
    success_cnt = 0;
    
    % each packet
    for i = 1 : packet_cnt
        is_packet_received = 
        % each bit
        for j = 1 : len_in_bit;
            snr = mean_snr + randn * sigma_snr;
            ber = snr2Ber(snr);
            if rand < ber
                break;
            else
                success_cnt = success_cnt + 1;
            end
        end
    end
    
    mean_pdr = success_cnt / packet_cnt;
end